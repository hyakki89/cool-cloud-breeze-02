{%- comment -%}
  Product Card Snippet
  Usage: {% render 'product-card', product: product %}
{%- endcomment -%}

<div class="product-card">
  <div class="product-card-media">
    <a href="{{ product.url }}" class="product-card-link">
      {%- if product.featured_media -%}
        <img
          src="{{ product.featured_media | image_url: width: 400 }}"
          alt="{{ product.featured_media.alt | escape }}"
          loading="lazy"
          class="product-card-image"
          width="{{ product.featured_media.width }}"
          height="{{ product.featured_media.height }}"
        />
      {%- else -%}
        <div class="product-card-placeholder">
          <span>Aucune image</span>
        </div>
      {%- endif -%}
      
      {%- if product.compare_at_price > product.price -%}
        <div class="product-card-badge">
          <span class="badge-sale">
            -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
          </span>
        </div>
      {%- endif -%}
    </a>
  </div>

  <div class="product-card-info">
    <h3 class="product-card-title">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>
    
    {%- if settings.show_vendor and product.vendor != blank -%}
      <div class="product-card-vendor">{{ product.vendor }}</div>
    {%- endif -%}

    <div class="product-card-price">
      {%- if product.compare_at_price > product.price -%}
        <span class="price-regular">{{ product.price | money }}</span>
        <span class="price-compare">{{ product.compare_at_price | money }}</span>
      {%- else -%}
        <span class="price-regular">{{ product.price | money }}</span>
      {%- endif -%}
    </div>

    {%- if settings.show_rating and product.metafields.reviews.rating.value != blank -%}
      <div class="product-card-rating">
        {%- assign rating = product.metafields.reviews.rating.value.rating -%}
        {%- for i in (1..5) -%}
          {%- if i <= rating -%}⭐{%- else -%}☆{%- endif -%}
        {%- endfor -%}
        <span class="rating-count">({{ product.metafields.reviews.rating.value.count }})</span>
      </div>
    {%- endif -%}

    <form action="/cart/add" method="post" enctype="multipart/form-data" class="product-card-form">
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
      <button
        type="submit"
        name="add"
        class="product-card-button"
        {%- if product.selected_or_first_available_variant.available == false -%}disabled{%- endif -%}
      >
        {%- if product.selected_or_first_available_variant.available -%}
          Ajouter au panier
        {%- else -%}
          Épuisé
        {%- endif -%}
      </button>
    </form>
  </div>
</div>